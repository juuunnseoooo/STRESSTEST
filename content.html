<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ìŠ¤íŠ¸ë ˆìŠ¤ ìê°€ì§„ë‹¨</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #eaf4f4;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 700px;
      margin: 50px auto;
      background-color: #ffffff;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
    }
    h1, h2 {
      text-align: center;
      color: #333;
    }
    button {
      background-color: #00a8cc;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      margin: 10px;
    }
    .question {
      margin-bottom: 20px;
    }
    .result {
      margin-top: 30px;
      background-color: #f1faff;
      padding: 20px;
      border-left: 6px solid #00a8cc;
      border-radius: 8px;
    }
    canvas {
      margin-top: 20px;
    }
    .link-button {
      background-color: transparent;
      color: #0077aa;
      text-decoration: underline;
      border: none;
      cursor: pointer;
      font-size: 14px;
      display: inline-block;
      margin-top: 10px;
    }
    iframe {
      width: 100%;
      height: 315px;
      margin-top: 20px;
      border-radius: 12px;
      border: none;
    }
  </style>
</head>
<body>
<div class="container">
  <h1>ìŠ¤íŠ¸ë ˆìŠ¤ ìê°€ì§„ë‹¨</h1>
  <div id="intro">
    <p>ì´ í…ŒìŠ¤íŠ¸ëŠ” 20ë¬¸í•­ì„ í†µí•´ ìŠ¤íŠ¸ë ˆìŠ¤ ìˆ˜ì¤€ê³¼ ê´€ë ¨ëœ ì •ì‹  ê±´ê°• ì§€í‘œë¥¼ í™•ì¸í•˜ê³  íë§ ì½˜í…ì¸ ë¥¼ ì¶”ì²œí•©ë‹ˆë‹¤.</p>
    <button onclick="startTest()">ìŠ¤íŠ¸ë ˆìŠ¤ ìê°€ì§„ë‹¨ ì‹œì‘í•˜ê¸°</button>
    <button class="link-button" onclick="window.open('https://www.ncmh.go.kr/nimh/index.do', '_blank')">ğŸ” ì§ˆë¬¸ ì¶œì²˜ ë° ì‹ ë¹™ì„± ë³´ê¸° (êµ­ë¦½ì •ì‹ ê±´ê°•ì„¼í„°)</button>
  </div>

  <form id="quizForm" style="display:none">
    <div id="questionContainer"></div>
    <div style="text-align:center; margin-top:20px;">
      <button type="button" id="prevBtn" onclick="prevQuestion()" style="display:none">ì´ì „</button>
      <button type="button" id="nextBtn" onclick="nextQuestion()">ë‹¤ìŒ</button>
      <button type="button" id="submitBtn" onclick="submitAnswers()" style="display:none">ê²°ê³¼ ë³´ê¸°</button>
    </div>
  </form>

  <div id="result" class="result" style="display:none"></div>
  <canvas id="resultChart" width="400" height="300" style="display:none"></canvas>
  <div id="videoContainer" style="display:none"></div>
</div>

<script>
  const questionsData = [
    { question: "ìµœê·¼ 2ì£¼ ë™ì•ˆ ê±°ì˜ ë§¤ì¼ ìš°ìš¸í•˜ê±°ë‚˜ ìŠ¬í”ˆ ê¸°ë¶„ì´ ë“¤ì—ˆë‚˜ìš”?", category: "ìš°ìš¸ì¦" },
    { question: "í‰ì†Œì— ê´€ì‹¬ ìˆê±°ë‚˜ ì¦ê¸°ë˜ í™œë™ì— ëŒ€í•œ í¥ë¯¸ê°€ ê°ì†Œí–ˆë‚˜ìš”?", category: "ìš°ìš¸ì¦" },
    { question: "ìŠ¤ìŠ¤ë¡œ ë¬´ê°€ì¹˜í•˜ë‹¤ê³  ëŠë¼ê±°ë‚˜ ì£„ì±…ê°ì„ ìì£¼ ëŠë¼ë‚˜ìš”?", category: "ìš°ìš¸ì¦" },
    { question: "ì—ë„ˆì§€ê°€ ë¶€ì¡±í•˜ê±°ë‚˜ í”¼ë¡œê°ì„ ìì£¼ ëŠë¼ë‚˜ìš”?", category: "ìš°ìš¸ì¦" },
    { question: "ìµœê·¼ ìì£¼ ê¸´ì¥í•˜ê±°ë‚˜ ë¶ˆì•ˆí•œ ëŠë‚Œì´ ìˆë‚˜ìš”?", category: "ë¶ˆì•ˆì¥ì• " },
    { question: "ê±±ì •ì´ ì§€ë‚˜ì¹˜ê²Œ ë§ê³  í†µì œí•˜ê¸° ì–´ë ¤ìš´ê°€ìš”?", category: "ë¶ˆì•ˆì¥ì• " },
    { question: "ì‰½ê²Œ ë†€ë¼ê³  ì‹ ê²½ì´ ì˜ˆë¯¼í•´ì¡Œë‚˜ìš”?", category: "ë¶ˆì•ˆì¥ì• " },
    { question: "ë¶ˆì•ˆìœ¼ë¡œ ì¸í•´ ì¼ìƒìƒí™œì— ì–´ë ¤ì›€ì„ ê²ªë‚˜ìš”?", category: "ë¶ˆì•ˆì¥ì• " },
    { question: "ì—…ë¬´ë‚˜ í•™ì—…ì— ì§€ì³ ë¬´ê¸°ë ¥í•¨ì„ ëŠë¼ë‚˜ìš”?", category: "ë²ˆì•„ì›ƒ" },
    { question: "ìì‹ ì˜ ì„±ì·¨ê°€ ë¶€ì¡±í•˜ë‹¤ê³  ëŠë¼ë©° ì˜ìš•ì´ ë–¨ì–´ì¡Œë‚˜ìš”?", category: "ë²ˆì•„ì›ƒ" },
    { question: "ì¼ì— ëŒ€í•œ ëƒ‰ì†Œì  íƒœë„ë‚˜ ë¶€ì •ì ì¸ ê°ì •ì„ ìì£¼ ëŠë¼ë‚˜ìš”?", category: "ë²ˆì•„ì›ƒ" },
    { question: "ì¶©ë¶„íˆ ì‰¬ì—ˆëŠ”ë°ë„ í”¼ë¡œê°€ í’€ë¦¬ì§€ ì•Šë‚˜ìš”?", category: "ë²ˆì•„ì›ƒ" },
    { question: "ê°‘ìê¸° ì‹¬ì¥ì´ ë¹¨ë¦¬ ë›°ê±°ë‚˜ ìˆ¨ì´ ê°€ë¹ ì§„ ì ì´ ìˆë‚˜ìš”?", category: "ê³µí™©ì¥ì• " },
    { question: "ê³µí™©ë°œì‘ìœ¼ë¡œ ì¸í•´ ì¼ìƒìƒí™œì— ì§€ì¥ì„ ë°›ì€ ì ì´ ìˆë‚˜ìš”?", category: "ê³µí™©ì¥ì• " },
    { question: "íŠ¹ì • ìƒí™©ì´ë‚˜ ì¥ì†Œë¥¼ í”¼í•˜ë ¤ê³  í•˜ë‚˜ìš”?", category: "ê³µí™©ì¥ì• " },
    { question: "ì£½ì„ ê²ƒ ê°™ì€ ê·¹ì‹¬í•œ ë‘ë ¤ì›€ì„ ëŠë‚€ ì ì´ ìˆë‚˜ìš”?", category: "ê³µí™©ì¥ì• " },
    { question: "ì‚¬ëŒë“¤ê³¼ ëŒ€í™”í•  ë•Œ ê³¼ë„í•˜ê²Œ ê¸´ì¥í•˜ë‚˜ìš”?", category: "ì‚¬íšŒë¶ˆì•ˆì¥ì• " },
    { question: "ë‹¤ë¥¸ ì‚¬ëŒë“¤ì´ ë‚˜ë¥¼ ë¶€ì •ì ìœ¼ë¡œ í‰ê°€í•œë‹¤ê³  ìƒê°í•˜ë‚˜ìš”?", category: "ì‚¬íšŒë¶ˆì•ˆì¥ì• " },
    { question: "ì‚¬ëŒì´ ë§ì€ ì¥ì†Œì—ì„œ ë¶ˆí¸í•¨ì´ë‚˜ ë‘ë ¤ì›€ì„ ëŠë¼ë‚˜ìš”?", category: "ì‚¬íšŒë¶ˆì•ˆì¥ì• " },
    { question: "ëª¨ì„ì´ë‚˜ ë°œí‘œë¥¼ í”¼í•˜ë ¤ëŠ” ê²½í–¥ì´ ìˆë‚˜ìš”?", category: "ì‚¬íšŒë¶ˆì•ˆì¥ì• " },
  ];

  let currentQuestionIndex = 0;
  const answers = new Array(questionsData.length).fill(null);

  function startTest() {
    document.getElementById("intro").style.display = "none";
    document.getElementById("quizForm").style.display = "block";
    showQuestion(currentQuestionIndex);
  }

  function showQuestion(index) {
    const container = document.getElementById("questionContainer");
    const q = questionsData[index];
    container.innerHTML = `
      <div class="question">
        <p><strong>Q${index + 1}.</strong> ${q.question}</p>
        <label><input type="radio" name="q" value="2" ${answers[index] === "2" ? "checked" : ""}> ìì£¼</label><br>
        <label><input type="radio" name="q" value="1" ${answers[index] === "1" ? "checked" : ""}> ê°€ë”</label><br>
        <label><input type="radio" name="q" value="0" ${answers[index] === "0" ? "checked" : ""}> ê±°ì˜ ì—†ìŒ</label>
      </div>
    `;

    // ë¼ë””ì˜¤ ë²„íŠ¼ í´ë¦­ ì‹œ ë°”ë¡œ ë‹¤ìŒ ì§ˆë¬¸ìœ¼ë¡œ ì´ë™
    const radios = container.querySelectorAll('input[name="q"]');
    radios.forEach(radio => {
      radio.addEventListener('change', () => {
        saveAnswer();
        if (currentQuestionIndex < questionsData.length - 1) {
          currentQuestionIndex++;
          showQuestion(currentQuestionIndex);
        }
      });
    });

    document.getElementById("prevBtn").style.display = index > 0 ? "inline-block" : "none";
    document.getElementById("nextBtn").style.display = index < questionsData.length - 1 ? "inline-block" : "none";
    document.getElementById("submitBtn").style.display = index === questionsData.length - 1 ? "inline-block" : "none";
  }

  function saveAnswer() {
    const selected = document.querySelector('input[name="q"]:checked');
    if (selected) {
      answers[currentQuestionIndex] = selected.value;
    }
  }

  function nextQuestion() {
    saveAnswer();
    if (answers[currentQuestionIndex] == null) {
      alert("ì‘ë‹µì„ ì„ íƒí•´ì£¼ì„¸ìš”.");
      return;
    }
    currentQuestionIndex++;
    showQuestion(currentQuestionIndex);
  }

  function prevQuestion() {
    saveAnswer();
    currentQuestionIndex--;
    showQuestion(currentQuestionIndex);
  }

  function submitAnswers() {
    saveAnswer();
    if (answers.includes(null)) {
      alert("ëª¨ë“  ë¬¸í•­ì— ì‘ë‹µí•´ ì£¼ì„¸ìš”.");
      return;
    }

    const scores = {
      ìš°ìš¸ì¦: 0,
      ë¶ˆì•ˆì¥ì• : 0,
      ë²ˆì•„ì›ƒ: 0,
      ê³µí™©ì¥ì• : 0,
      ì‚¬íšŒë¶ˆì•ˆì¥ì• : 0,
    };

    answers.forEach((val, i) => {
      const category = questionsData[i].category;
      scores[category] += parseInt(val);
    });

    showResults(scores);
  }

  function showResults(scores) {
    const resultDiv = document.getElementById("result");
    resultDiv.style.display = "block";
    document.getElementById("resultChart").style.display = "block";
    document.getElementById("videoContainer").style.display = "block";

    // ê°€ì¥ ì ìˆ˜ ë†’ì€ ì¹´í…Œê³ ë¦¬ ì¶”ì¶œ
    let maxCategory = "";
    let maxScore = -1;
    for (const [key, value] of Object.entries(scores)) {
      if (value > maxScore) {
        maxScore = value;
        maxCategory = key;
      }
    }

    let categoryDesc = {
      "ìš°ìš¸ì¦": "ìš°ìš¸ì¦ì€ ì§€ì†ì ì¸ ìŠ¬í””, ë¬´ê¸°ë ¥ê°, í¥ë¯¸ ìƒì‹¤ ë“±ì´ íŠ¹ì§•ì¸ ì •ì‹  ê±´ê°• ë¬¸ì œì…ë‹ˆë‹¤.",
      "ë¶ˆì•ˆì¥ì• ": "ë¶ˆì•ˆì¥ì• ëŠ” ê³¼ë„í•œ ê±±ì •ê³¼ ê¸´ì¥ì´ ì¼ìƒìƒí™œì— ì˜í–¥ì„ ë¯¸ì¹˜ëŠ” ìƒíƒœì…ë‹ˆë‹¤.",
      "ë²ˆì•„ì›ƒ": "ë²ˆì•„ì›ƒì€ ì¥ê¸°ê°„ì˜ ìŠ¤íŠ¸ë ˆìŠ¤ì™€ ê³¼ë¡œë¡œ ì¸í•œ ì‹ ì²´ì , ì •ì‹ ì  íƒˆì§„ ìƒíƒœì…ë‹ˆë‹¤.",
      "ê³µí™©ì¥ì• ": "ê³µí™©ì¥ì• ëŠ” ê°‘ì‘ìŠ¤ëŸ½ê³  ë°˜ë³µì ì¸ ê·¹ì‹¬í•œ ê³µí¬ ë°œì‘ì„ ê²½í—˜í•˜ëŠ” ìƒíƒœì…ë‹ˆë‹¤.",
      "ì‚¬íšŒë¶ˆì•ˆì¥ì• ": "ì‚¬íšŒë¶ˆì•ˆì¥ì• ëŠ” ì‚¬íšŒì  ìƒí™©ì—ì„œ ê³¼ë„í•œ ë‘ë ¤ì›€ê³¼ ê¸´ì¥ì„ ëŠë¼ëŠ” ìƒíƒœì…ë‹ˆë‹¤.",
    };

    resultDiv.innerHTML = `
      <h2>ì§„ë‹¨ ê²°ê³¼</h2>
      <p><strong>ê°€ì¥ ê´€ë ¨ìˆëŠ” ì •ì‹  ì§ˆí™˜: ${maxCategory}</strong></p>
      <p>${categoryDesc[maxCategory]}</p>
      ${getHealingContent(maxCategory)}
    `;

    renderChart(scores);
  }

  // ìœ íŠœë¸Œ ì˜ìƒ ì„ë² ë“œ (ì¬ìƒí™•ì¸ëœ ì˜ìƒ ID ì‚¬ìš©)
  function getHealingContent(category) {
    const videos = {
      "ìš°ìš¸ì¦": "2OEL4P1Rz04",
      "ë¶ˆì•ˆì¥ì• ": "M-LJ5v7H8DA",
      "ë²ˆì•„ì›ƒ": "KLFu4YV7CSs",
      "ê³µí™©ì¥ì• ": "Z0iaNw8-WzE",
      "ì‚¬íšŒë¶ˆì•ˆì¥ì• ": "6zSfAWhVEOE",
    };
    const videoId = videos[category];
    return `<p>íë§ ì˜ìƒ:</p><iframe src="https://www.youtube.com/embed/${videoId}" title="íë§ ì˜ìƒ" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>`;
  }

  function renderChart(scores) {
    const ctx = document.getElementById('resultChart').getContext('2d');
    if(window.barChart instanceof Chart) {
      window.barChart.destroy();
    }
    window.barChart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: Object.keys(scores),
        datasets: [{
          label: 'ì ìˆ˜',
          data: Object.values(scores),
          backgroundColor: [
            '#ff6384',
            '#36a2eb',
            '#ffcd56',
            '#4bc0c0',
            '#9966ff'
          ]
        }]
      },
      options: {
        scales: {
          y: {
            beginAtZero: true,
            max: 8
          }
        },
        plugins: {
          legend: { display: false },
          tooltip: {
            callbacks: {
              label: context => `${context.parsed.y} ì `
            }
          }
        }
      }
    });
  }
</script>
</body>
</html>
